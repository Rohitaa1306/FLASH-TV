# MUST PERFORM THIS PROCEDURE MANUALLY FOR NOW
# MAKE SURE YOU HAVE ALREADY RUN full_initial_setup.sh WITH NO ERRORS AND ALL IDS ARE SET UP AND SERVICES HAVE BEEN ENABLED BUT NOT STARTED

### SHOULD BE DONE BEFORE GOING TO HOMES
# You have to run homeassistant at least once manually before copying the configuration file
cd ~/ha
source bin/activate
hass
# Now that homeassistant has initialized you have to open localhost:8123 in the browser and follow the setup with the instructions below
# While you are setting it up, it might refresh/reset the page once or twice, just redo it
# It also might hang for a while, just be patient
# Choose the name (username should autofill to be the same as name) and password (I chose them to be the same as the Jetson's)
# Name the installation the same as the username
# If you are not at a family's home, click Detect to set the metrics and move the location pin away a little if preferred
# Do not select anything to share (this should already be the default so just press Next)
# Ignore the devices and click Finish
# Click on Settings on the bottom left, then Devices & Services, and make sure the native Bluetooth module is discovered and configure it if it already isn't
# Ignore all other devices and disable the default ones if you wish

### SHOULD BE DONE AT HOMES
# After the Bluetooth module is configured, if the smart plug is plugged into a socket it should show up on the same screen
# If the smart plug does not show up, try pressing the button on its side to make sure it's turned on (there should be a white LED light)
# NOTE THE FOUR CHARACTER ID OF THE SMART PLUG, MAKE SURE YOU KNOW WHICH PLUG AND LOCATION IT CORRESPONDS TO, DO NOT MIX THEM UP
# Configure and set up the smart plug, set the area to whatever matches, you can name a new area if necessary
# Click on the History tab on the middle left, then Choose entity, and select something that looks like "Plug Mini YYYY Power"
# If the data is coming in as expected, go on to the next steps, otherwise troubleshoot
# STOP HOMEASSISTANT (Ctrl-C)
# Open the configuration.yaml in the ~/flash-tv-scripts/install_scripts folder (NOT THE ONE IN THE .homeassistant FOLDER)
# Look for the line where it says 'sensor.plug_mini_YYYY_power' and REPLACE YYYY WITH A *LOWERCASE VERSION* OF THE FOUR CHARACTER ID YOU NOTED EARLIER
# Save the file and copy it to overrwrite the configuration.yaml in the ~/.homeassistant folder (enable show hidden files if not already done)
# Start homeassistant again and make sure there are no errors
# Check ~/ha to make sure the .csv log is being written (this will not be the only way of obtaining the data but it is useful as a backup)
# Make sure to turn off the internet, leave homeassistant on and make sure the service is running, and check for errors if there's time

### WHEN CHANGING FAMILIES/PLUGS AND REUSING THE DEVICE
# Make sure the homeassistant data is copied and saved in multiple ways (.csv in ~/data/123XXX_data folder, .csv from addon, .db from ~/.homeassistant folder, etc.)
# Make sure the FLASH-TV data (~/data folder) is copied and saved as well just case
# Make sure homeassistant is shutdown
# Delete the flash-tv-scripts folder, the ~/.homeassistant folder, and the .csv file in the ~/data/123XXX_data folder
# Reclone the flash-tv-scripts folder
# RUN family_change_setup.sh IF YOU HAVEN'T ALREADY
# Redo the above steps from the beginning
